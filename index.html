<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ¿ AgriSense AI</title>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'green-dark': '#1B5E20',       /* Darkest Green */
                        'green-medium': '#2E7D32',     /* Medium Green */
                        'green-light': '#E8F5E9',      /* Light Green for button BG */
                        'transparent-white': 'rgba(255, 255, 255, 0.95)',
                        'error-red': '#B71C1C',
                        'success-green': '#4CAF50',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            /* Simple subtle background pattern */
            background-image: linear-gradient(45deg, #eaf2e3 25%, transparent 25%), 
                              linear-gradient(-45deg, #eaf2e3 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #eaf2e3 75%), 
                              linear-gradient(-45deg, transparent 75%, #eaf2e3 75%);
            background-size: 20px 20px;
        }
        .card-shadow {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }
        /* Custom spinner animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            border-top-color: #388E3C;
            animation: spin 1s ease-in-out infinite;
        }
        /* Style for the file input button to make it invisible but functional */
        #file-input-label {
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Main Card Container -->
    <div id="app-card" class="bg-transparent-white p-8 md:p-10 rounded-3xl w-full max-w-lg mx-auto card-shadow flex flex-col items-center border border-gray-200">

        <!-- Title and Subtitle -->
        <h1 class="text-4xl md:text-5xl font-extrabold text-green-dark mb-1">ðŸŒ¿ AgriSense AI</h1>
        <p class="text-lg text-green-medium mb-8 text-center">Intelligent crop health analysis</p>

        <!-- Image Display Area -->
        <div class="w-full h-64 md:h-80 bg-gray-100 rounded-xl overflow-hidden mb-6 flex items-center justify-center border-4 border-dashed border-gray-300">
            <img id="img-display" src="https://placehold.co/400x320/E1F0E4/2E7D32?text=Ready+to+Upload" 
                 onerror="this.src='https://placehold.co/400x320/E1F0E4/2E7D32?text=Ready+to+Upload'"
                 class="w-full h-full object-contain transition duration-500 ease-in-out transform hover:scale-105" 
                 alt="Crop Image Display">
        </div>

        <!-- Hidden File Input -->
        <input type="file" id="file-input" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
        
        <!-- Buttons and Loader -->
        <div class="w-full flex flex-col items-center">
            
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 w-full justify-center">
                
                <!-- Upload Button -->
                <button id="upload-btn" onclick="document.getElementById('file-input').click()" 
                        class="w-full md:w-auto bg-green-light text-green-dark py-3 px-8 rounded-xl font-semibold shadow-md hover:bg-gray-200 transition duration-200 flex items-center justify-center space-x-2 border border-green-dark/20">
                    <!-- Icon: UPLOAD_FILE -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    <span>Upload & Analyze</span>
                </button>
                
                <!-- Camera Button (Mock) -->
                <button onclick="showMessage('Camera feature coming soon! ðŸ“¸', 'gray')"
                        class="w-full md:w-auto bg-green-medium text-white py-3 px-8 rounded-xl font-semibold shadow-md hover:bg-green-dark/90 transition duration-200 flex items-center justify-center space-x-2">
                    <!-- Icon: CAMERA_ALT -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                    <span>Take Picture</span>
                </button>
            </div>
            
            <!-- Loading Indicator -->
            <div id="loading-indicator" class="mt-6 flex items-center space-x-3 text-green-medium hidden">
                <div class="spinner border-4 border-gray-200 rounded-full w-6 h-6"></div>
                <span class="font-medium">Analyzing... please wait.</span>
            </div>
        </div>

        <!-- Result Display Area -->
        <div id="result-label" class="mt-8 text-gray-700 text-lg text-center font-semibold min-h-[3rem] p-3 rounded-xl w-full bg-gray-50/70 border border-gray-200">
            Awaiting image. Click 'Upload & Analyze' to begin.
        </div>
        
    </div>

    <script>
        // Mapping color names to Tailwind classes
        const COLOR_MAP = {
            success: 'text-success-green bg-green-light border-success-green/50',
            error: 'text-error-red bg-red-100 border-error-red/50',
            gray: 'text-gray-700 bg-gray-100 border-gray-300',
        };

        const resultLabel = document.getElementById('result-label');
        const loadingIndicator = document.getElementById('loading-indicator');
        const uploadBtn = document.getElementById('upload-btn');

        // Utility to update the result display area
        function showMessage(text, type = 'gray') {
            // Remove previous color/background classes
            Object.values(COLOR_MAP).forEach(cls => resultLabel.classList.remove(...cls.split(' ')));
            
            // Apply new text and color classes
            resultLabel.textContent = text;
            const newClasses = (COLOR_MAP[type] || COLOR_MAP.gray).split(' ');
            resultLabel.classList.add(...newClasses);
        }
        
        // Mock Python backend function (simulating analyze_crop_health)
        function mockAnalyzeCropHealth() {
            // Mock logic: 80% chance of being healthy, 20% chance of being diseased
            const isHealthy = Math.random() < 0.8;
            
            return new Promise(resolve => {
                // Simulate network latency (2 seconds)
                setTimeout(() => {
                    if (isHealthy) {
                        resolve({
                            text: "âœ… Health Check: Your crop is thriving and shows no signs of disease!",
                            type: 'success'
                        });
                    } else {
                        resolve({
                            text: "ðŸš« ALERT: Early signs of Fungal Rust detected. Recommended action: Fungicide (e.g., Azoxystrobin) treatment within 48 hours.",
                            type: 'error'
                        });
                    }
                }, 2500); // 2.5 seconds delay to mimic real analysis
            });
        }

        // Main handler for image file selection
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            const imgDisplay = document.getElementById('img-display');

            if (!file) {
                showMessage("Upload cancelled. Awaiting image.", 'gray');
                return;
            }

            // 1. Show image preview immediately
            const reader = new FileReader();
            reader.onload = function(e) {
                imgDisplay.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // 2. Set UI to Analyzing state
            uploadBtn.disabled = true;
            uploadBtn.classList.add('opacity-50', 'cursor-not-allowed');
            loadingIndicator.classList.remove('hidden');
            showMessage("Analysis in progress...", 'gray');
            
            try {
                // 3. Call the mock analysis function
                const result = await mockAnalyzeCropHealth();

                // 4. Update the result label
                showMessage(result.text, result.type);

            } catch (error) {
                showMessage("An internal analysis error occurred. Please try a different image.", 'error');
                console.error("Analysis Error:", error);
            } finally {
                // 5. Reset UI state
                uploadBtn.disabled = false;
                uploadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                loadingIndicator.classList.add('hidden');
            }
        }

        // Initialize display text on load
        window.onload = () => {
             // Initial message is already set in HTML, but here for clarity.
        };
    </script>
</body>
</html>